Below is the **CKS-style solution** for **Question 8**, which is a *very common real exam scenario* involving **strict/restricted Pod Security Admission (PSA)** or **OPA Gatekeeper**â€“like rules preventing pods from running in a namespace.

Iâ€™ll give you:

âœ… What the question means
âœ… Formula for fixing the issue
âœ… Step-by-step solution
âœ… Exact YAML patches for a compliant pod
âœ… The typical â€œrestrictedâ€ PSA requirements
âœ… Common exam mistakes

---

# ğŸ§© **QUESTION 8 â€” Namespace `confidential` Enforced with Restricted Rules â†’ Pods Fail to Run**

## ğŸ¯ **WHAT THE QUESTION IS REALLY ABOUT**

A namespace named **`confidential`** has **Pod Security Admission (restricted)** applied.

Meaning:

ğŸ”’ Only **restricted** security settings are allowed in this namespace.
âŒ Default pods will **NOT start** unless they meet restricted rules.

**Your task:**

ğŸ‘‰ Modify the Pod/Deployment YAML so it **complies with the restricted PSA**.

This is a classic CKS task.

---

# ğŸ” **WHAT "RESTRICTED" MEANS (CKS CHEAT SHEET)**

To run inside a â€œrestrictedâ€ namespace, pods must include:

### Mandatory fields:

```
runAsNonRoot: true
runAsUser: <non-root UID>
allowPrivilegeEscalation: false
readOnlyRootFilesystem: true
```

### Prohibited fields:

```
privileged: true          âŒ
hostPID / hostIPC / hostNetwork: true âŒ
capabilities: add: ["NET_ADMIN"] (or any adds) âŒ
seLinuxOptions (often blocked) âŒ
```

### Allowed only if dropped:

```
capabilities:
  drop: ["ALL"]
```

### AppArmor (if mentioned):

```
container.apparmor.security.beta.kubernetes.io/<name>: runtime/default
```

---

# ğŸ§± **STEP-BY-STEP SOLUTION**

## **Step 1 â€” Inspect namespace**

```bash
kubectl get ns confidential --show-labels
```

You will see something like:

```
pod-security.kubernetes.io/enforce=restricted
```

---

## **Step 2 â€” Try to create a pod (it fails)**

You might see errors like:

```
pod is forbidden: violates PodSecurity "restricted"
```

This is expected.

---

## **Step 3 â€” Patch your Pod/Deployment to satisfy "restricted"**

Add the following under each **container securityContext**:

```yaml
securityContext:
  runAsNonRoot: true
  runAsUser: 1000         # or UID provided in the exam
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  capabilities:
    drop:
    - ALL
```

If the Deployment used `securityContext` at pod level, add:

```yaml
securityContext:
  fsGroup: 2000
  runAsNonRoot: true
```

(Only if needed.)

---

# ğŸ“Œ **FINAL YAML FIX (What the CKS grader expects)**

**Example Deployment inside `confidential` namespace:**

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: secure-app
  namespace: confidential
spec:
  replicas: 1
  template:
    spec:
      containers:
      - name: app
        image: nginx
        securityContext:
          runAsNonRoot: true
          runAsUser: 1000
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          capabilities:
            drop:
            - ALL
```

---

# âš ï¸ **COMMON MISTAKES (These will FAIL PSA restricted)**

âŒ Missing `runAsNonRoot`
âŒ `runAsUser` set to "0" (root)
âŒ Missing `allowPrivilegeEscalation: false`
âŒ Missing `readOnlyRootFilesystem: true`
âŒ Adding capabilities
âŒ Using privileged containers
âŒ hostNetwork / hostPID / hostIPC set to true
âŒ Putting securityContext at wrong indentation

---

# ğŸ” **Why pods were not running?**

Because restricted PSA requires containers to **not run as root** and to follow strong securityContext rules.
Any default container configuration violates these rules â†’ Pod rejected.

After adding the fields above â†’ Pod will run successfully.

---

# ğŸš€ Want to continue?

Send **Question 9** if you have one. I can build the **full combined CKS practice exam** from questions 1â€“8 as a PDF if you want.
